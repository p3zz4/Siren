!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.Siren=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=this.initCanvas(),this.ctx=this.canvas.getContext("2d"),this.playPauseBtn=this.initPlayPauseBtn(),this.rightPanel=this.initRightPanel(),this.playlist=this.initPlaylist(),this.bottomPanel=this.initBottomPanel(),this.audio=this.initAudio(),this.sourceElements=[],this.analyser=this.initAnalyser(),this.requestID=null,this.updateLocalPlaylist(),this.initKeyboardShortcuts()}return i(e,[{key:"domElementCreator",value:function(e,t,n){var i=document.createElement(e);return t.appendChild(i),i.classList.add(n),i}},{key:"initPlayPauseBtn",value:function(){var e=this,t=this.domElementCreator("div",document.body,"playPauseBtn"),n=this.domElementCreator("span",t,"span");return n.innerHTML='<i class="fas fa-play"></i>',n.addEventListener("click",function(){0===e.audio.childElementCount?e.playFirstTrack():!0===e.audio.paused?e.audio.play():e.audio.pause()}),n}},{key:"togglePlayPauseBtn",value:function(){this.playPauseBtn.innerHTML=!0===this.audio.paused?'<i class="fas fa-play"></i>':'<i class="fas fa-pause"></i>'}},{key:"initBottomPanel",value:function(){var e=this,t=this.domElementCreator("div",document.body,"bottomPanel"),n=this.domElementCreator("div",t,"controls"),i=this.domElementCreator("span",n,"playNextTrackBtn");i.innerHTML='<i class="fas fa-fast-backward"></i>',i.addEventListener("click",function(){e.playPreviousTrack()});var a=this.domElementCreator("span",n,"playNextTrackBtn");return a.innerHTML='<i class="fas fa-fast-forward"></i>',a.addEventListener("click",function(){e.playNextTrack()}),t}},{key:"initRightPanel",value:function(){var e=this,t=this.domElementCreator("div",document.body,"rightPanel"),n=this.domElementCreator("input",t,"loader");n.type="file",n.id="file",n.accept=".mp3",n.multiple=!0;var i=this.domElementCreator("label",t,"label");return i.htmlFor="file",i.innerHTML='<i class="fas fa-plus"></i>',n.addEventListener("change",function(t){[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(n.files)).map(function(e){return e.name.slice(0,-4)}).sort(function(e,t){return e<t}).reduce(function(t,n){return t.then(function(t){return e.addToRemotePlaylist(n,"../data/music/"+n+".mp3")})},Promise.resolve([])).then(function(t){e.updateLocalPlaylist()})}),t}},{key:"initPlaylist",value:function(){return this.domElementCreator("div",this.rightPanel,"playlist")}},{key:"initCanvas",value:function(){var e=this.domElementCreator("canvas",document.body,"canvas");return e.width=window.innerWidth,e.height=window.innerHeight,window.addEventListener("resize",function(){e.width=window.innerWidth,e.height=window.innerHeight}),e}},{key:"initAudio",value:function(){var e=this,t=this.domElementCreator("audio",this.bottomPanel,"audio");return t.controls="contols",t.preload="auto",t.addEventListener("play",function(t){e.runVisualizer(),e.togglePlayPauseBtn()}),t.addEventListener("pause",function(t){e.stopVisualizer(),e.togglePlayPauseBtn()}),t.addEventListener("ended",function(t){e.playNextTrack()}),t}},{key:"addSourceToQueue",value:function(e,t){var n=document.createElement("source");n.type="audio/mpeg",n.src=e,this.sourceElements[t]=n}},{key:"playTrackAtIndex",value:function(e){this.audio.pause(),this.audio.innerHTML="",this.audio.appendChild(this.sourceElements[e]),this.audio.load(),this.audio.play()}},{key:"playFirstTrack",value:function(){0!==this.sourceElements.length&&this.playTrackAtIndex(0)}},{key:"playNextTrack",value:function(){0!==this.sourceElements.length&&this.playTrackAtIndex((this.sourceElements.indexOf(this.audio.firstChild)+1)%this.sourceElements.length)}},{key:"playPreviousTrack",value:function(){0!==this.sourceElements.length&&0!==this.sourceElements.length&&this.playTrackAtIndex((this.sourceElements.indexOf(this.audio.firstChild)+this.sourceElements.length-1)%this.sourceElements.length)}},{key:"forwardFiveSec",value:function(e){e.currentTime+=5}},{key:"backwardFiveSec",value:function(e){e.currentTime-=5}},{key:"muteAudio",value:function(e){e.muted=!0!==e.muted}},{key:"initAnalyser",value:function(){var e=new AudioContext,t=e.createAnalyser();return e.createMediaElementSource(this.audio).connect(t),t.connect(e.destination),t}},{key:"updateVisualizer",value:function(){var e=this;this.requestID=requestAnimationFrame(function(t){return e.updateVisualizer()});var t=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(t),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#0DDEFF";for(var n=this.canvas.width/3>=1024?this.canvas.width/3:1023,i=0;i<n;i++){var a=3*i,r=.004*-t[i]*window.innerHeight*.8;this.ctx.fillRect(a,this.canvas.height,2,r)}}},{key:"runVisualizer",value:function(){var e=this;this.requestID=requestAnimationFrame(function(t){return e.updateVisualizer()})}},{key:"stopVisualizer",value:function(){var e=this;setTimeout(function(t){cancelAnimationFrame(e.requestID)},2e3)}},{key:"addToRemotePlaylist",value:function(e,t){return fetch("http://localhost:3000/playlist",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:""+e,path:""+t})})}},{key:"updateLocalPlaylist",value:function(){var e=this;return this.sourceElements=[],this.playlist.innerHTML="",fetch("http://localhost:3000/playlist").then(function(t){return t.json().then(function(t){return t.reverse().forEach(function(t,n){var i=e.domElementCreator("div",e.playlist,"track"),a=e.domElementCreator("div",i,"deleteBtn");a.innerHTML='<i class="fas fa-times"></i>',a.addEventListener("click",function(i){fetch("http://localhost:3000/playlist/"+t.id,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"DELETE"}).catch(function(e){console.log(e)}),i.stopPropagation(),a.parentNode.parentNode.removeChild(a.parentNode),e.sourceElements.splice(n,1)}),e.domElementCreator("div",i,"name").innerHTML="Name: "+t.name,i.addEventListener("click",function(t){e.playTrackAtIndex(n)}),e.addSourceToQueue(""+t.path,n)})})})}},{key:"initKeyboardShortcuts",value:function(){var e=this;window.addEventListener("keydown",function(t){32==t.which&&e.playPauseBtn.click(),37==t.which&&e.backwardFiveSec(e.audio),39==t.which&&e.forwardFiveSec(e.audio),77==t.which&&e.muteAudio(e.audio)})}}]),e}()},function(e,t,n){"use strict";new(n(0).Siren)}]);
//# sourceMappingURL=siren.bundle.js.map